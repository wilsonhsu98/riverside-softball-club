<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        background-color: green;
        margin: 0;
        padding: 0;
      }
      button {
        vertical-align: top;
      }
    </style>
  </head>
  <body>
    <button id="back">Back</button>
    <button class="feedback" data-answer="Repetitive">Repetitive</button>
    <button class="feedback" data-answer="Inappropriate">Inappropriate</button>
    <button class="feedback" data-answer="Cover the content">Cover the content</button>
    <button class="feedback" data-answer="Misleading">Misleading</button>
    <script>
      document.querySelector('#back').addEventListener('click', function() {
        window.parent.postMessage('closeIframe', '*');
      });
    </script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

      const firebaseApp = initializeApp({
        apiKey: "AIzaSyDS5TfzuJ6QTCPXtEat4raasJer2NwMgjg",
        authDomain: "ad-user-feedback.firebaseapp.com",
        projectId: "ad-user-feedback",
      });

      document.addEventListener('click', event => {
        const target = event.target;
        if (target.tagName === 'BUTTON' && target.classList.contains('feedback')) {
          const urlParams = new URLSearchParams(window.location.search);
          const db = getFirestore();
          try {
            addDoc(collection(db, "feedbacks"), {
              bidobjid: urlParams.get('bidobjid'),
              cid: urlParams.get('cid'),
              oid: urlParams.get('oid'),
              crid: urlParams.get('crid'),
              answer: target.getAttribute('data-answer'),
            })
            .then(res => {
              console.log(res);
              alert('feedback done')
            })
          } catch (e) {
            console.error("Error adding document: ", e);
          }
        }
      });
    </script>
  </body>
</html>
